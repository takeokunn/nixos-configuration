# AIエージェント仕様書

## 概要

本ドキュメントは、Claude Codeで使用するカスタムエージェントの仕様を定義します。各エージェントは特定の責任領域を持ち、親エージェントからの指示に基づいて自律的にタスクを実行します。

## エージェント構成

### Critical Priority（最優先）

| ファイル    | 責任領域               | 主要タスク                             |
| ----------- | ---------------------- | -------------------------------------- |
| security.md | セキュリティ脆弱性検出 | 脆弱性スキャン・修正提案               |
| design.md   | システム設計検証       | アーキテクチャ整合性・設計パターン検証 |

### High Priority（高優先度）

| ファイル       | 責任領域               | 主要タスク                               |
| -------------- | ---------------------- | ---------------------------------------- |
| quality.md     | コード品質保証         | 静的解析・コードレビュー・品質メトリクス |
| performance.md | パフォーマンス最適化   | ボトルネック特定・最適化実装             |
| docs.md        | ドキュメント管理       | 技術文書作成・API仕様書管理              |
| refactor.md    | コードリファクタリング | 技術的負債解消・コード改善               |

### Medium Priority（中優先度）

| ファイル   | 責任領域             | 主要タスク                       |
| ---------- | -------------------- | -------------------------------- |
| test.md    | テスト戦略・品質管理 | テスト設計・実装・カバレッジ向上 |
| cleanup.md | 不要コード削除       | デッドコード検出・依存関係整理   |

### On-Demand（必要時）

| ファイル | 責任領域 | 主要タスク             |
| -------- | -------- | ---------------------- |
| merge.md | 競合解決 | マージコンフリクト解消 |

### Continuous（継続実行）

| ファイル  | 責任領域       | 主要タスク                       |
| --------- | -------------- | -------------------------------- |
| memory.md | 知識ベース管理 | パターン記録・規約管理・知識蓄積 |

## エージェント仕様書形式

各エージェントの仕様書は以下の形式に従います。

### メタデータ

```yaml
---
name: エージェント名
description: 責任領域の簡潔な説明
priority: critical|high|medium|low|on-demand|continuous
tools:
  - ツール名1
  - ツール名2
---
```

### 必須セクション

1. **目的** - エージェントの存在意義と解決する課題
2. **入力条件**
   - 必須パラメータ: 実行に必要な情報
   - 任意パラメータ: 最適化のための追加情報
3. **処理フロー**
   - 前処理: 入力検証・環境確認
   - 主処理: コアロジック・アルゴリズム
   - 後処理: 結果検証・クリーンアップ
4. **成功条件**
   - 必須条件: 満たすべき最低要件
   - 品質条件: 望ましい品質基準
5. **エラー処理**
   - エラー分類: エラーコードと重要度
   - リカバリー処理: 自動復旧手順
   - エスカレーション: 親エージェントへの報告

## 共通規則

### エラー形式

```json
{
  "error": "ERROR_CODE",
  "severity": "critical|high|medium|low",
  "message": "エラーの詳細な説明",
  "context": {
    "file": "エラー発生ファイル",
    "line": 行番号,
    "suggestion": "修正提案"
  }
}
```

### 成功条件の基準値

- **エラー数**: 0（critical/high priority）
- **警告数**: 0（medium以上のpriority）
- **テストカバレッジ**: ≥80%
- **静的解析スコア**: ≥90/100
- **パフォーマンス**: ベースライン比で劣化なし

### 出力形式

エージェントは以下の形式で結果を報告します。

```json
{
  "status": "success|warning|error",
  "summary": "処理結果のサマリー",
  "metrics": {
    "処理時間": "2.5s",
    "変更ファイル数": 5,
    "修正項目数": 12
  },
  "details": [
    {
      "type": "info|warning|error",
      "message": "詳細メッセージ",
      "location": "ファイル:行番号"
    }
  ],
  "next_actions": ["推奨される次のアクション"]
}
```

## エージェント連携

### 依存関係

```
security.md → quality.md → test.md
design.md → refactor.md → cleanup.md
performance.md → refactor.md
docs.md → (全エージェント)
memory.md → (全エージェント)
```

### 実行順序

1. **設計フェーズ**: design.md
2. **実装フェーズ**: quality.md → refactor.md → cleanup.md
3. **検証フェーズ**: security.md → performance.md → test.md
4. **文書化フェーズ**: docs.md
5. **継続フェーズ**: memory.md

## ベストプラクティス

### エージェント選択基準

- **単一責任**: 各エージェントは1つの明確な責任領域を持つ
- **優先順位順守**: critical → high → medium の順で実行
- **並列実行**: 依存関係のないエージェントは並列実行可能
- **早期失敗**: criticalエージェントが失敗した場合は即座に中断

### メモリ活用

エージェントは実行前に必ず以下を実施:

1. `list_memories` - 関連する過去の知見を確認
2. `read_memory` - 適用すべきパターン・規約を取得
3. `write_memory` - 新しい知見・パターンを記録

### ツール活用

エージェントは以下のツールを積極的に活用:

- **Serena MCP**: コード解析・シンボル操作
- **Context7**: ライブラリ最新情報取得
- **Bash**: 静的解析ツール・テストフレームワーク実行
- **Task**: 複雑なサブタスクの委譲

## 拡張ガイドライン

新しいエージェントを追加する場合:

1. 責任領域が既存エージェントと重複しないことを確認
2. 優先度を適切に設定（既存エージェントとのバランス）
3. 仕様書形式に従ってドキュメントを作成
4. README.mdのエージェント構成テーブルを更新
5. 依存関係を明確に定義
